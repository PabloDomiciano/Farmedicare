{% extends 'modelo.html' %}
{% load static %}
{% block titulo %}<title>{{ title }}</title>{% endblock %}

{% block conteudo %}
<main class="main-content">
  <header class="content-header">
    <h1>{{ titulo }}</h1>
  </header>
  {% block conteudo_admin %}{% endblock %}
{% endblock %}

{% block cards %}{% endblock %}

{% block graficos %}
  <style>
    /* Card de Lista */
    .lista-card {
      background-color: white;
      border-radius: 12px;
      box-shadow: 0 2px 20px rgba(0, 0, 0, 0.08);
      padding: 0;
      margin: 1.5rem auto;
      max-width: 1400px;
      overflow: hidden;
      animation: fadeInUp 0.5s ease-out;
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .lista-header {
      background: linear-gradient(135deg, #fb8c00 0%, #f57c00 100%);
      color: white;
      padding: 1.5rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 1rem;
    }

    .lista-title-section {
      flex: 1;
    }

    .lista-title {
      font-size: 1.5rem;
      font-weight: 600;
      margin-bottom: 0.25rem;
    }

    .lista-subtitle {
      font-size: 0.9rem;
      opacity: 0.9;
    }

    .lista-actions {
      display: flex;
      gap: 1rem;
      align-items: center;
      flex-wrap: wrap;
    }

    .btn-add {
      background-color: white;
      color: #f57c00;
      padding: 0.75rem 1.5rem;
      border-radius: 8px;
      text-decoration: none;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      transition: all 0.3s;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      white-space: nowrap;
    }

    .btn-add:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      background-color: #f5f5f5;
    }

    /* Barra de Pesquisa */
    .search-container {
      margin: 20px auto;
      padding: 0 20px;
      max-width: 1200px;
    }

    .search-form {
      display: flex;
      gap: 10px;
      align-items: center;
      flex-wrap: wrap;
    }

    .search-input-wrapper {
      flex: 1;
      position: relative;
      min-width: 200px;
    }

    .search-input {
      width: 100%;
      padding: 10px 40px 10px 15px;
      border: 2px solid #fb8c00;
      border-radius: 8px;
      font-size: 14px;
      transition: all 0.3s ease;
    }

    .search-input:focus {
      outline: none;
      border-color: #f57c00;
      box-shadow: 0 0 8px rgba(245, 124, 0, 0.3);
    }

    .search-icon {
      position: absolute;
      right: 15px;
      top: 50%;
      transform: translateY(-50%);
      color: #fb8c00;
      pointer-events: none;
    }

    .search-btn,
    .clear-btn {
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      white-space: nowrap;
      transition: all 0.2s;
      display: inline-flex;
      align-items: center;
      gap: 5px;
      font-weight: 600;
    }

    .search-btn {
      background-color: #fb8c00;
      color: white;
    }

    .search-btn:hover {
      background-color: #f57c00;
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(245, 124, 0, 0.3);
    }

    .clear-btn {
      background-color: #6c757d;
      color: white;
      text-decoration: none;
    }

    .clear-btn:hover {
      background-color: #5a6268;
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(108, 117, 125, 0.3);
    }

    .search-result-info {
      margin-top: 10px;
      color: #666;
      font-size: 14px;
      padding: 8px 12px;
      background: #fff3e0;
      border-left: 4px solid #fb8c00;
      border-radius: 4px;
    }

    .search-result-info strong {
      color: #f57c00;
    }

    /* Tema Laranja para Parcelas de Despesas (A Pagar) */
    .parcelas-filters {
      background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(245, 124, 0, 0.15);
      margin: 20px auto;
      max-width: 1200px;
      border: 2px solid #fb8c00;
    }

    .filter-buttons {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      margin-bottom: 15px;
    }

    .filter-btn {
      padding: 10px 20px;
      border: 2px solid #fb8c00;
      background: white;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s;
      font-size: 14px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
      color: #f57c00;
    }

    .filter-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(251, 140, 0, 0.3);
    }

    .filter-btn.active {
      background: linear-gradient(135deg, #fb8c00 0%, #f57c00 100%);
      color: white;
      border-color: #f57c00;
    }

    .filter-btn.status-pago {
      border-color: #10b981;
    }

    .filter-btn.status-pago.active {
      background: #10b981;
      border-color: #10b981;
    }

    .filter-btn.status-pendente {
      border-color: #f59e0b;
    }

    .filter-btn.status-pendente.active {
      background: #f59e0b;
      border-color: #f59e0b;
    }

    .filter-btn.status-vencido {
      border-color: #b91c1c;
    }

    .filter-btn.status-vencido.active {
      background: #b91c1c;
      border-color: #b91c1c;
    }

    .filter-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      padding-top: 15px;
      border-top: 2px solid #fb8c00;
    }

    .stat-card {
      background: white;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      border-left: 4px solid #fb8c00;
    }

    .stat-label {
      color: #666;
      font-size: 13px;
      margin-bottom: 5px;
    }

    .stat-value {
      font-weight: bold;
      font-size: 20px;
      color: #f57c00;
    }

    /* Badges de status */
    .status-badge {
      padding: 6px 14px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      display: inline-block;
      letter-spacing: 0.5px;
    }

    .status-pago {
      background: #d1fae5;
      color: #065f46;
    }

    .status-pendente {
      background: #fef3c7;
      color: #92400e;
    }

    .status-vencido {
      background: #fee2e2;
      color: #991b1b;
    }

    /* Destaque visual nas linhas */
    .modelo-table tbody tr.parcela-vencida {
      background: #fef2f2 !important;
      border-left: 4px solid #dc2626;
    }

    .modelo-table tbody tr.parcela-paga {
      background: #f0fdf4 !important;
      opacity: 0.85;
    }

    .modelo-table tbody tr.parcela-paga:hover {
      opacity: 1 !important;
      transform: scale(1.01);
      box-shadow: 0 4px 12px rgba(16, 185, 129, 0.2);
    }

    .modelo-table tbody tr.parcela-pendente {
      background: white !important;
    }

    .modelo-table tbody tr:hover {
      background: #fff3e0 !important;
      transform: scale(1.01);
      box-shadow: 0 4px 12px rgba(245, 124, 0, 0.15);
      transition: all 0.3s;
    }

    /* Valores em destaque */
    .valor-destaque {
      font-weight: bold;
      font-size: 15px;
    }

    .valor-pago {
      color: #10b981;
    }

    .valor-pendente {
      color: #f57c00;
    }

    /* Informa√ß√£o da movimenta√ß√£o */
    .info-movimentacao {
      font-size: 12px;
      color: #666;
      margin-top: 4px;
    }

    /* Contador de filtros */
    .filter-count {
      background: white;
      color: #f57c00;
      border-radius: 12px;
      padding: 2px 8px;
      font-size: 12px;
      margin-left: 5px;
      font-weight: bold;
    }

    /* Bot√µes de A√ß√£o */
    .action-buttons {
      display: flex;
      gap: 0.5rem;
    }

    .btn-icon {
      width: 32px;
      height: 32px;
      border-radius: 6px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      text-decoration: none;
      transition: all 0.2s;
      border: 1px solid transparent;
    }

    .btn-edit {
      color: #1976d2;
      background-color: #e3f2fd;
    }

    .btn-edit:hover {
      background-color: #bbdefb;
      transform: scale(1.1);
    }

    .btn-delete {
      color: #d32f2f;
      background-color: #ffebee;
    }

    .btn-delete:hover {
      background-color: #ffcdd2;
      transform: scale(1.1);
    }

    /* Cabe√ßalhos clic√°veis com setinhas de ordena√ß√£o */
    .modelo-table thead th {
      cursor: pointer;
      user-select: none;
      position: relative;
      padding-right: 30px;
      color: white !important;
    }

    .modelo-table thead th:hover {
      background-color: #e65100 !important;
      color: white !important;
    }

    .modelo-table thead th::after {
      content: '\f0dc';
      font-family: 'Font Awesome 5 Free';
      font-weight: 900;
      position: absolute;
      right: 10px;
      opacity: 0.3;
      font-size: 12px;
      color: white;
    }

    .modelo-table thead th.sortable::after {
      opacity: 0.6;
    }

    .modelo-table thead th.asc::after {
      content: '\f0de';
      opacity: 1;
      color: white;
    }

    .modelo-table thead th.desc::after {
      content: '\f0dd';
      opacity: 1;
      color: white;
    }

    /* Responsividade */
    @media (max-width: 768px) {
      .lista-header {
        flex-direction: column;
        gap: 1rem;
      }

      .lista-title-section h2 {
        font-size: 1.75rem;
      }

      .lista-actions {
        width: 100%;
        justify-content: center;
      }

      .btn-add {
        width: 100%;
        justify-content: center;
      }

      .search-form {
        gap: 8px;
      }

      .search-input-wrapper {
        min-width: 150px;
      }

      .search-input {
        font-size: 13px;
        padding: 9px 35px 9px 12px;
      }

      .search-btn,
      .clear-btn {
        padding: 9px 16px;
        font-size: 13px;
      }
    }

    @media (max-width: 576px) {
      .lista-title-section h2 {
        font-size: 1.5rem;
      }
      
      .lista-subtitle {
        font-size: 0.9rem;
      }

      .search-form {
        flex-direction: column;
        gap: 10px;
      }

      .search-input-wrapper {
        width: 100%;
        min-width: unset;
      }

      .search-btn,
      .clear-btn {
        width: 100%;
        justify-content: center;
        padding: 10px;
      }

      .search-result-info {
        font-size: 12px;
      }
    }

    @media (max-width: 400px) {
      .search-btn .btn-text,
      .clear-btn .btn-text {
        display: none;
      }

      .search-btn,
      .clear-btn {
        width: auto;
        min-width: 45px;
      }

      .search-form {
        flex-direction: row;
      }

      .search-input-wrapper {
        flex: 1;
      }
    }
  </style>

  <div class="lista-card">
    <!-- Header da Lista -->
    <div class="lista-header">
      <div class="lista-title-section">
        <h2 class="lista-title">
          <i class="fas fa-money-check-alt"></i> Parcelas a Pagar
        </h2>
        <p class="lista-subtitle">Gerenciamento de parcelas pendentes e pagas</p>
      </div>
      <div class="lista-actions">
        <a href="{% url 'cadastrar_despesa' %}" class="btn-add">
          <i class="fas fa-plus"></i>
          Nova Despesa
        </a>
      </div>
    </div>

  <!-- Barra de Pesquisa -->
  <div class="search-container">
    <form method="get" action="" class="search-form">
      <div class="search-input-wrapper">
        <input 
          type="text" 
          name="search" 
          id="searchInput"
          value="{{ search_query|default:'' }}" 
          placeholder="Pesquisar parcelas..."
          class="search-input"
        />
        <i class="fas fa-search search-icon"></i>
      </div>
      
      <button type="submit" class="btn btn-primary search-btn">
        <i class="fas fa-search"></i> 
        <span class="btn-text">Pesquisar</span>
      </button>
      
      {% if search_query %}
      <a href="?" class="btn btn-secondary clear-btn">
        <i class="fas fa-times"></i> 
        <span class="btn-text">Limpar</span>
      </a>
      {% endif %}
      
      {% for key, value in request.GET.items %}
        {% if key != 'search' and key != 'page' %}
          <input type="hidden" name="{{ key }}" value="{{ value }}">
        {% endif %}
      {% endfor %}
    </form>
    
    {% if search_query %}
    <div class="search-result-info">
      <i class="fas fa-info-circle"></i> 
      Pesquisando por: <strong>{{ search_query }}</strong>
      {% if page_obj.paginator.count %}
        - {{ page_obj.paginator.count }} resultado(s) encontrado(s)
      {% endif %}
    </div>
    {% endif %}
  </div>

  <!-- Filtros e Estat√≠sticas -->
  <div class="parcelas-filters">
    <div class="filter-buttons">
      <button class="filter-btn active" data-filter="todos">
        <i class="fas fa-list"></i>
        Todas <span class="filter-count" id="count-todos">0</span>
      </button>
      <button class="filter-btn status-pago" data-filter="pago">
        <i class="fas fa-check-circle"></i>
        Pagas <span class="filter-count" id="count-pago">0</span>
      </button>
      <button class="filter-btn status-pendente" data-filter="pendente">
        <i class="fas fa-clock"></i>
        Pendentes <span class="filter-count" id="count-pendente">0</span>
      </button>
      <button class="filter-btn status-vencido" data-filter="vencido">
        <i class="fas fa-exclamation-triangle"></i>
        Vencidas <span class="filter-count" id="count-vencido">0</span>
      </button>
    </div>

    <div class="filter-stats">
      <div class="stat-card">
        <div class="stat-label">üí∏ Total de Parcelas</div>
        <div class="stat-value" id="total-parcelas">0</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">üìä Valor Total</div>
        <div class="stat-value" id="valor-total">R$ 0,00</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">‚è≥ Valor a Pagar</div>
        <div class="stat-value" style="color: #f57c00;" id="valor-pendente">R$ 0,00</div>
      </div>
    </div>
  </div>

  <!-- Tabela de Parcelas a Pagar -->
  <div class="modelo-lista-container">
    <div class="table-container">
      <table class="modelo-table">
        <thead>
          <tr>
            <th class="sortable" data-column="parceiro">Fornecedor/Parceiro</th>
            <th class="sortable" data-column="parcela">Parcela</th>
            <th class="sortable" data-column="valor">Valor</th>
            <th class="sortable" data-column="vencimento">Vencimento</th>
            <th class="sortable" data-column="valor-pago">Valor Pago</th>
            <th class="sortable" data-column="status">Status</th>
            <th class="sortable" data-column="pagamento">Pagamento</th>
            <th>A√ß√µes</th>
          </tr>
        </thead>
        <tbody id="parcelas-tbody">
          {% for parcela in object_list %}
            {% now "Y-m-d" as today %}
            <tr class="parcela-row {% if parcela.status_pagamento == 'Pago' %}parcela-paga{% elif parcela.data_vencimento|date:'Y-m-d' < today and parcela.status_pagamento != 'Pago' %}parcela-vencida{% else %}parcela-pendente{% endif %}" 
                data-status="{% if parcela.status_pagamento == 'Pago' %}pago{% elif parcela.data_vencimento|date:'Y-m-d' < today and parcela.status_pagamento != 'Pago' %}vencido{% else %}pendente{% endif %}"
                data-valor="{{ parcela.valor_parcela }}"
                data-valor-pago="{{ parcela.valor_pago }}"
                data-parceiro="{% if parcela.movimentacao.parceiros %}{{ parcela.movimentacao.parceiros.nome }}{% else %}Sem parceiro{% endif %}"
                data-parcela="{{ parcela.ordem_parcela }}"
                data-vencimento="{{ parcela.data_vencimento|date:'Y-m-d' }}"
                data-pagamento="{% if parcela.data_quitacao %}{{ parcela.data_quitacao|date:'Y-m-d' }}{% else %}9999-12-31{% endif %}"
                data-search="{{ parcela.movimentacao.categoria.tipo }} {% if parcela.movimentacao.parceiros %}{{ parcela.movimentacao.parceiros.nome }}{% endif %} {{ parcela.ordem_parcela }}">
              
              <td>
                <strong style="color: #f57c00;">
                  {% if parcela.movimentacao.parceiros %}
                    {{ parcela.movimentacao.parceiros.nome }}
                  {% else %}
                    <em style="color: #999;">Sem parceiro</em>
                  {% endif %}
                </strong>
                <div class="info-movimentacao">
                  <i class="fas fa-tag" style="color: #fb8c00;"></i> {{ parcela.movimentacao.categoria.nome }}
                  | <i class="fas fa-home" style="color: #fb8c00;"></i> {{ parcela.movimentacao.fazenda.nome }}
                </div>
              </td>
              
              <td style="text-align: center;">
                <strong style="font-size: 16px; color: #f57c00;">{{ parcela.ordem_parcela }}/{{ parcela.movimentacao.parcelas }}</strong>
              </td>
              
              <td class="valor-destaque valor-pendente">
                R$ {{ parcela.valor_parcela|floatformat:2 }}
              </td>
              
              <td>
                <strong>{{ parcela.data_vencimento|date:"d/m/Y" }}</strong>
                <div style="font-size: 12px; color: #666; margin-top: 4px;">
                  {{ parcela.data_vencimento|date:"D" }}
                </div>
                {% if parcela.status_pagamento != 'Pago' and parcela.data_vencimento|date:'Y-m-d' < today %}
                  <div style="font-size: 11px; color: #dc2626; margin-top: 3px; font-weight: 600;">
                    <i class="fas fa-exclamation-circle"></i> Atrasada
                  </div>
                {% endif %}
              </td>
              
              <td class="valor-destaque {% if parcela.valor_pago >= parcela.valor_parcela %}valor-pago{% else %}valor-pendente{% endif %}">
                R$ {{ parcela.valor_pago|floatformat:2 }}
              </td>
              
              <td>
                {% if parcela.status_pagamento == 'Pago' %}
                  <span class="status-badge status-pago">
                    <i class="fas fa-check-circle"></i> Pago
                  </span>
                {% elif parcela.data_vencimento|date:'Y-m-d' < today %}
                  <span class="status-badge status-vencido">
                    <i class="fas fa-exclamation-triangle"></i> Vencida
                  </span>
                {% else %}
                  <span class="status-badge status-pendente">
                    <i class="fas fa-clock"></i> Pendente
                  </span>
                {% endif %}
              </td>
              
              <td>
                {% if parcela.data_quitacao %}
                  <strong style="color: #10b981;">{{ parcela.data_quitacao|date:"d/m/Y" }}</strong>
                {% else %}
                  <span style="color: #999;">-</span>
                {% endif %}
              </td>
              
              <td style="text-align: center;">
                <div class="action-buttons">
                  <a href="{% url 'editar_parcela' parcela.id %}" 
                     class="btn-icon btn-edit"
                     title="Editar parcela">
                    <i class="fas fa-edit"></i>
                  </a>
                  <a href="{% url 'excluir_parcela' parcela.id %}" 
                     class="btn-icon btn-delete"
                     title="Excluir parcela">
                    <i class="fas fa-trash-alt"></i>
                  </a>
                </div>
              </td>
            </tr>
          {% empty %}
            <tr>
              <td colspan="8" style="text-align: center; padding: 60px 20px; color: #666;">
                <i class="fas fa-inbox" style="font-size: 64px; margin-bottom: 20px; opacity: 0.3; display: block;"></i>
                <h3 style="color: #999; font-size: 20px; margin-bottom: 10px;">Nenhuma parcela encontrada</h3>
                <p style="color: #aaa; font-size: 14px;">N√£o h√° parcelas a pagar cadastradas no momento.</p>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
      <!-- Pagina√ß√£o -->
      {% include "paginacao.html" %}
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const filterButtons = document.querySelectorAll('.filter-btn');
      const parcelaRows = document.querySelectorAll('.parcela-row');
      const searchInput = document.getElementById('searchInput');
      const tableHeaders = document.querySelectorAll('.modelo-table thead th.sortable');
      const tbody = document.getElementById('parcelas-tbody');
      let currentFilter = 'todos';
      let sortColumn = 'vencimento';
      let sortOrder = 'asc';

      // Se n√£o h√° parcelas, n√£o executa o JavaScript de filtros
      if (parcelaRows.length === 0) {
        return;
      }

      // Ordena√ß√£o inicial por vencimento (do mais antigo para o mais recente)
      const vencimentoHeader = document.querySelector('th[data-column="vencimento"]');
      if (vencimentoHeader) {
        vencimentoHeader.classList.add('asc');
      }
      ordenarTabela('vencimento', 'asc');
      calcularEstatisticas();

      // Ordena√ß√£o de colunas
      tableHeaders.forEach(header => {
        header.addEventListener('click', function() {
          const column = this.dataset.column;
          
          if (sortColumn === column) {
            sortOrder = sortOrder === 'asc' ? 'desc' : 'asc';
          } else {
            sortColumn = column;
            sortOrder = 'asc';
          }

          tableHeaders.forEach(h => h.classList.remove('asc', 'desc'));
          this.classList.add(sortOrder);

          ordenarTabela(column, sortOrder);
        });
      });

      filterButtons.forEach(button => {
        button.addEventListener('click', function() {
          filterButtons.forEach(btn => btn.classList.remove('active'));
          this.classList.add('active');
          currentFilter = this.dataset.filter;
          aplicarFiltros();
        });
      });

      // Pesquisa agora √© feita no backend via formul√°rio
      // Removido: searchInput.addEventListener('input', aplicarFiltros);

      function aplicarFiltros() {
        // Filtro apenas por status (n√£o por pesquisa - isso √© backend)
        parcelaRows.forEach(row => {
          const status = row.dataset.status;
          
          const statusMatch = currentFilter === 'todos' || status === currentFilter;
          
          row.style.display = statusMatch ? '' : 'none';
        });
        
        calcularEstatisticas();
      }

      function calcularEstatisticas() {
        let totalParcelas = 0;
        let totalPagas = 0;
        let totalPendentes = 0;
        let totalVencidas = 0;
        let valorTotal = 0;
        let valorPendente = 0;  // Valor a pagar (pendentes + vencidas)
        
        // Contadores gerais para os badges (TODOS os registros)
        let countTodosGeral = 0;
        let countPagoGeral = 0;
        let countPendenteGeral = 0;
        let countVencidoGeral = 0;

        // Primeiro loop: conta TODOS os registros para os badges dos filtros
        parcelaRows.forEach(row => {
          const status = row.dataset.status;
          
          countTodosGeral++;
          if (status === 'pago') countPagoGeral++;
          else if (status === 'vencido') countVencidoGeral++;
          else if (status === 'pendente') countPendenteGeral++;
        });

        // Segundo loop: calcula estat√≠sticas apenas das linhas VIS√çVEIS
        parcelaRows.forEach(row => {
          if (row.style.display !== 'none') {
            const status = row.dataset.status;
            const valor = parseFloat(row.dataset.valor);
            const valorPg = parseFloat(row.dataset.valorPago);

            totalParcelas++;
            valorTotal += valor;

            if (status === 'pago') {
              totalPagas++;
            } else if (status === 'vencido') {
              totalVencidas++;
              valorPendente += (valor - valorPg);  // Soma pendentes e vencidas
            } else if (status === 'pendente') {
              totalPendentes++;
              valorPendente += (valor - valorPg);  // Soma pendentes e vencidas
            }
          }
        });

        // Atualiza contadores dos filtros (sempre mostram o total geral)
        document.getElementById('count-todos').textContent = countTodosGeral;
        document.getElementById('count-pago').textContent = countPagoGeral;
        document.getElementById('count-pendente').textContent = countPendenteGeral;
        document.getElementById('count-vencido').textContent = countVencidoGeral;

        // Atualiza estat√≠sticas (mostram apenas o que est√° vis√≠vel)
        document.getElementById('total-parcelas').textContent = totalParcelas;
        document.getElementById('valor-total').textContent = formatarMoeda(valorTotal);
        document.getElementById('valor-pendente').textContent = formatarMoeda(valorPendente);
      }

      function formatarMoeda(valor) {
        return 'R$ ' + valor.toFixed(2).replace('.', ',').replace(/\B(?=(\d{3})+(?!\d))/g, '.');
      }

      function ordenarTabela(column, order) {
        const rowsArray = Array.from(tbody.querySelectorAll('.parcela-row'));
        
        rowsArray.sort((a, b) => {
          let aValue, bValue;

          if (column === 'valor' || column === 'valor-pago') {
            aValue = parseFloat(column === 'valor' ? a.dataset.valor : a.dataset.valorPago);
            bValue = parseFloat(column === 'valor' ? b.dataset.valor : b.dataset.valorPago);
          } else if (column === 'parcela') {
            aValue = parseInt(a.dataset.parcela);
            bValue = parseInt(b.dataset.parcela);
          } else if (column === 'vencimento') {
            aValue = new Date(a.dataset.vencimento);
            bValue = new Date(b.dataset.vencimento);
          } else if (column === 'pagamento') {
            aValue = new Date(a.dataset.pagamento);
            bValue = new Date(b.dataset.pagamento);
          } else if (column === 'status') {
            aValue = a.dataset.status;
            bValue = b.dataset.status;
          } else if (column === 'parceiro') {
            aValue = a.dataset.parceiro.toLowerCase();
            bValue = b.dataset.parceiro.toLowerCase();
          }

          if (order === 'asc') {
            return aValue > bValue ? 1 : aValue < bValue ? -1 : 0;
          } else {
            return aValue < bValue ? 1 : aValue > bValue ? -1 : 0;
          }
        });

        tbody.innerHTML = '';
        rowsArray.forEach(row => tbody.appendChild(row));
        aplicarFiltros();
      }
    });
  </script>
  </div>
{% endblock %}

{% block ultimos_registros %}{% endblock %}
</main>
