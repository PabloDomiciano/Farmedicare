{% extends 'modelo.html' %}
{% load static %}

{% block titulo %}<title>TESTE - {{ title }}</title>{% endblock %}

{% block conteudo %}
<main class="main-content">
  <header class="content-header">
    <h1>üß™ TESTE - {{ titulo }}</h1>
    <p style="color: red; font-weight: bold;">VERS√ÉO DE DEBUG - SEM JAVASCRIPT</p>
  </header>
{% endblock %}

{% block cards %}{% endblock %}

{% block graficos %}
  <div style="background: white; padding: 20px; margin: 20px; border-radius: 8px;">
    
    <h2>üìä Informa√ß√µes de Debug</h2>
    <ul style="background: #f0f0f0; padding: 15px; margin: 10px 0;">
      <li><strong>Usu√°rio:</strong> {{ request.user.username }}</li>
      <li><strong>Fazenda Ativa:</strong> {{ request.fazenda_ativa.nome|default:"NENHUMA" }}</li>
      <li><strong>Total no Context:</strong> {{ receitas|length }}</li>
      <li><strong>Total Calculado:</strong> {{ total_receitas }}</li>
    </ul>

    <h2>üìã Tabela SIMPLES (Sem JavaScript)</h2>
    
    {% if receitas %}
      <table border="1" cellpadding="10" style="width: 100%; border-collapse: collapse;">
        <thead style="background: #4caf50; color: white;">
          <tr>
            <th>ID</th>
            <th>Parceiro</th>
            <th>Categoria</th>
            <th>Valor</th>
            <th>Parcelas</th>
            <th>Data</th>
            <th>Fazenda</th>
          </tr>
        </thead>
        <tbody>
          {% for receita in receitas %}
          <tr style="{% cycle 'background: white;' 'background: #f9f9f9;' %}">
            <td>{{ receita.id }}</td>
            <td>{{ receita.parceiros.nome|default:"Sem parceiro" }}</td>
            <td>{{ receita.categoria.nome }}</td>
            <td>R$ {{ receita.valor_total }}</td>
            <td>{{ receita.parcelas }}x</td>
            <td>{{ receita.data|date:"d/m/Y" }}</td>
            <td>{{ receita.fazenda.nome }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      
      <p style="margin-top: 20px; font-weight: bold; color: green;">
        ‚úÖ Total de {{ receitas|length }} receita(s) encontrada(s)
      </p>
    {% else %}
      <div style="background: #ffeb3b; padding: 20px; margin: 20px 0; border-radius: 8px;">
        <h3>‚ö†Ô∏è NENHUMA RECEITA ENCONTRADA</h3>
        <p><strong>Poss√≠veis causas:</strong></p>
        <ul>
          <li>Fazenda n√£o est√° ativa</li>
          <li>N√£o h√° receitas cadastradas para esta fazenda</li>
          <li>Query est√° retornando vazio</li>
        </ul>
      </div>
    {% endif %}

    <hr>
    
    <h3>üîç Query Debug</h3>
    <pre style="background: #f0f0f0; padding: 15px; overflow-x: auto;">
Filtros aplicados:
- categoria__tipo = 'receita'
- fazenda = {{ request.fazenda_ativa.nome|default:"NONE" }}
    </pre>

  </div>
{% endblock %}

{% block ultimos_registros %}{% endblock %}
</main>
```